# NFL Single Game - Результаты анализа

## Обзор

Данный документ содержит результаты анализа наиболее успешных составов (top 1% по результатам) в турнирах NFL Single Game на платформе DraftKings. Анализ основан на исторических данных, обработанных через слои Staging → DDS → Marts и визуализированных в Apache Superset.

## Источник данных

- **Тип турнира:** NFL Single Game
- **Выборка:** Топ 1-й процентиль составов (наиболее успешные lineup'ы)
- **Слой данных:** DDS (Data Detail Storage) + Position Correlations Mart
- **Инструмент визуализации:** Apache Superset Dashboard

## Дашборд

![NFL Single Game Dashboard](../../img/nfl_single_game.png)

---

## Ключевые находки

### 1. Корреляции позиций

Анализ показывает, какие позиции чаще всего встречаются вместе в успешных составах:

| Позиция 1 | Позиция 2 | Команда | Корреляция | Размер выборки |
|-----------|-----------|---------|------------|----------------|
| QB | QB | Противник | **0.451** | 988 |
| RB | D | Та же | **0.386** | 73 |
| QB | WR | Та же | **0.347** | 5133 |
| WR | QB | Та же | **0.312** | 3542 |
| RB | QB | Та же | **0.267** | 1986 |
| QB | TE | Та же | **0.247** | 2837 |
| D | K | Та же | **0.246** | 346 |
| TE | QB | Та же | **0.245** | 2240 |
| QB | WR | Противник | **0.265** | 4987 |
| K | D | Та же | **0.214** | 93 |

#### Интерпретация корреляций:

**QB-QB (opponent_team): 0.451** - Наивысшая корреляция
- Включение квотербеков обеих команд - эффективная стратегия
- Это имеет смысл в матчах с высоким ожидаемым счетом (shootout games)
- Большая выборка (988) подтверждает статистическую значимость

**RB-D (same_team): 0.386** - Сильная положительная корреляция
- Включение защиты вместе с раннингбеком своей команды
- Меньшая выборка (73), но высокая корреляция

**QB-WR (same_team): 0.347** и **WR-QB: 0.312** - Стекинг (game stacking)
- Классическая стратегия: объединение QB и WR одной команды
- Очень большая выборка (5133 и 3542) - основная стратегия
- Любое тачдаун-соединение QB→WR приносит двойные очки

**QB-TE (same_team): 0.247** и **TE-QB: 0.245**
- Умеренная корреляция QB с тайт-эндом
- Ниже, чем с WR, но все равно положительная

**QB-WR (opponent_team): 0.265** - Стратегия "bring-back"
- Включение WR команды-соперника к собственному QB
- Хеджирование риска: если QB противника хорош, их WR тоже набирает
- Работает в матчах с высоким темпом и частыми передачами


### 2. Распределение позиций на капитанской позиции (CPT)

Анализ топ 1% составов показывает следующее распределение позиций в слоте Captain:

**Результаты (примерное распределение по диаграмме):**

- **WR (Wide Receiver):** ~40-45% - **Наиболее популярная капитанская позиция**
- **RB (Running Back):** ~30-35% - Вторая по популярности
- **QB (Quarterback):** ~15-20% - Третья позиция
- **TE (Tight End):** ~3-5% - Редко используется
- **D (Defense):** ~2-3% - Очень редко
- **K (Kicker):** <2% - Практически не используется

#### Интерпретация:

**Доминирование WR в слоте CPT:**
- Wide Receivers имеют высокий потенциал для взрывных игр
- 1.5x множитель капитана максимизирует очки от больших плеев (long TD receptions)
- Менее стабильны, чем квотербеки, но часто бывают решающим фактором для победы в соревновании

**RB на второй позиции:**
- Стабильность через комбинацию rushing + receiving yards
- Потенциал для множественных тачдаунов
- Элитные RB часто эффективны как капитаны

**QB реже используется как капитан:**
- Несмотря на высокие очки, QB обычно стабильнее предсказуемы
- Более эффективно использовать QB во FLEX слотах
- CPT слот лучше для позиций с высокой вариативностью

**TE, D, K крайне редки:**
- Низкий ceiling (потолок очков) у этих позиций
- Неэффективно использовать 1.5x множитель
- Используется только в очень специфических ситуациях

### 3. Использование защиты (Defense) в составах

Анализ показывает частоту включения защиты в топовые составы:

**Результаты:**

- **0 защит:** ~65-70% составов - **Большинство**
- **1 защита:** ~30-35% составов - Значительная доля
- **2 защиты:** <5% составов - Очень редко

#### Интерпретация:

**Большинство составов без защиты:**
- В Single Game формате больше внимания на атакующих игроков
- Защита имеет меньший потенциал для высоких очков
- Приоритет на игроков с высоким использованием (usage)

**~30% составов с одной защитой:**
- Эффективно в матчах с ожидаемым доминированием одной команды
- Хорошо работает в сочетании с RB, K той же команды (корреляция)
- Стратегия "game script control" - контроль хода игры

**Две защиты практически не используются:**
- Слишком низкий потолок очков
- Занимают слоты, которые лучше использовать для атакующих позиций
- Возможно эффективно только в очень низкоскоринговых играх (defensive battles)

### 4. Количество игроков соперника против защиты

Когда защита включена в состав (top 1% lineups), анализируется, сколько игроков команды-соперника присутствует:

**Результаты (при наличии защиты в составе):**

- **2 игрока соперника:** ~45% - **Наиболее частый вариант**
- **1 игрок соперника:** ~25% - Второй по частоте
- **3 игрока соперника:** ~20% - Умеренно часто
- **4 игрока соперника:** ~7% - Редко
- **5 игроков соперника:** ~3% - Очень редко

#### Интерпретация:

**Баланс 2 игрока соперника + защита:**
- Оптимальный баланс между доверием к защите и хеджированием
- Позволяет получить очки, если команда соперника тоже набирает
- Минимизирует риск полного провала, если защита не сработала

**1 игрок соперника:**
- Более агрессивная ставка на доминирование защиты
- Минимальное хеджирование
- Работает в сценариях с ожидаемым разгромом

---

## Стратегические рекомендации

На основе проанализированных данных можно сформулировать следующие рекомендации для построения составов в NFL Single Game:

### 1. Приоритет на стекинг QB + WR одной команды
- Корреляция 0.347 - сильная
- Большая выборка подтверждает эффективность
- Каждое TD-соединение приносит двойную пользу

### 2. Рассмотреть QB обеих команд в высокоскоринговых матчах
- Наивысшая корреляция 0.451
- Работает в games с высоким O/U (over/under)
- Позволяет выиграть на множественных передачах

### 3. WR или RB как капитан - основная стратегия
- ~75-80% успешных составов используют эти позиции
- QB реже эффективен как капитан
- Ориентироваться на игроков с высоким ceiling

### 4. Защита - ситуационная позиция
- Использовать в ~30% составов
- Эффективна с RB, K той же команды
- При включении: оптимально 2 игрока соперника для баланса

### 5. Избегать использования двух защит
- <5% в успешных составах
- Лучше использовать слоты для атакующих позиций

---

## Методология анализа

### Слои обработки данных:

1. **Staging Layer:** Сырые данные из DraftKings API (JSONL + gzip)
2. **DDS Layer:** Нормализованные данные (Parquet + Snappy)
   - Таблицы: players, users, user_lineups, lineups
3. **Marts Layer:** Аналитические витрины данных
   - **Position Correlations Mart:** Корреляции между позициями
   - Фильтрация top 1% составов (lineup_percentile <= 0.01)

### Технологии:

- **Хранилище:** AWS S3 (Wasabi)
- **Обработка:** DuckDB + Spark
- **Оркестрация:** Apache Airflow
- **Визуализация:** Apache Superset

---

## Примечания

- Данный анализ основан на исторических данных и может варьироваться в зависимости от типа турнира (GPP vs Cash)
- Корреляции показывают статистическую связь, но не гарантируют будущий успех
- Для каждого конкретного матча необходимо учитывать дополнительные факторы:
  - Погодные условия
  - Травмы ключевых игроков
  - Ожидаемый темп игры и общее количество очков (O/U)
  - Собственность игроков (ownership)

---

## Дальнейшие направления анализа

- Анализ зависимости стратегий от размера турнира (field size)
- Корреляция с ownership (процент владения игроков)
- Анализ эффективности в зависимости от Vegas lines (ставки букмекеров)
- Сравнение стратегий для разных типов турниров (GPP vs. Double-Up)
- Анализ других видов спорта (NBA, NHL, MLB)
